import{r as l,j as e,H as X,a as C,t as m}from"./app-Xlek0bwg.js";import{C as G,A as J,U as K}from"./app-layout-DW9h-HtL.js";import{T as Q,a as W,b as g,c as n,d as Y,e as r}from"./table-B0_gU9G3.js";import{B as i}from"./button-Dy2Oic53.js";import{B as Z}from"./badge-C6O3gg0V.js";import{I as ee}from"./input-CzO4wCAD.js";import{D as F,a as T,b as D,c as k,d as I,e as R}from"./dialog-Ctnxf9FD.js";import{L as se}from"./label-TTFJ3vkY.js";import{T as ae}from"./textarea-CVfnZ0m2.js";import{C as A}from"./circle-check-big-DEEOYper.js";import{L as f}from"./loader-circle-t3AOmsLR.js";import{T as L,M as te,S as le}from"./x-BOABAh6w.js";import{S as re}from"./search-BSz4uhRu.js";import{C as ie}from"./calendar-BEDHZeUe.js";import{E as ne}from"./eye-BmrgNANU.js";import{C as ce}from"./chevron-left-B06CiaQF.js";import{C as oe}from"./chevron-right-CtqqchXs.js";import{C as de}from"./circle-x-Cujky8x-.js";/* empty css            */import"./Combination-CUeGIgD_.js";import"./createLucideIcon-CG5XqwtN.js";import"./index-YRfMnEnD.js";import"./index-EBLA1b0H.js";import"./credit-card-D09o6vYK.js";function ze({stats:x={total:0,completed:0,in_progress:0,requires_followup:0,today:0,this_month:0}}){const[w,z]=l.useState([]),[u,y]=l.useState(!0),[o,B]=l.useState(0),[t,b]=l.useState({page:1,pageSize:10,search:""}),[a,O]=l.useState(null),[M,d]=l.useState(!1),[P,p]=l.useState(!1),[N,S]=l.useState(""),[h,j]=l.useState(null),v=async()=>{y(!0);try{const s={draw:Date.now(),start:(t.page-1)*t.pageSize,length:t.pageSize,search:{value:t.search,regex:!1}},c=await C.get("/admin/field-controls",{params:s,headers:{Accept:"application/json"}});z(c.data.data),B(c.data.recordsTotal)}catch(s){console.error("Failed to fetch controls",s),m.error("Failed to load field controls")}finally{y(!1)}};l.useEffect(()=>{const s=setTimeout(()=>{v()},300);return()=>clearTimeout(s)},[t.page,t.search]);const $=s=>{O(s),d(!0)},q=async()=>{if(a){j(a.id);try{await C.post(`/admin/field-controls/${a.id}/approve`),m.success("Field control approved successfully"),v(),d(!1)}catch(s){m.error(s.response?.data?.message||"Failed to approve")}finally{j(null)}}},E=async()=>{if(a){j(a.id);try{await C.post(`/admin/field-controls/${a.id}/reject`,{reason:N}),m.success("Field control flagged successfully"),v(),p(!1),d(!1),S("")}catch(s){m.error(s.response?.data?.message||"Failed to flag")}finally{j(null)}}},H=s=>{switch(s){case"completed":case"approved":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";case"requires_followup":return"bg-amber-100 text-amber-800 border-amber-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-slate-100 text-slate-800 border-slate-200"}},_=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),U=Math.ceil(o/t.pageSize),V=[{label:"Total Controls",value:x.total,icon:G,bgColor:"#1e40af"},{label:"Completed",value:x.completed,icon:A,bgColor:"#059669"},{label:"In Progress",value:x.in_progress,icon:f,bgColor:"#d97706"},{label:"Requires Follow-up",value:x.requires_followup,icon:L,bgColor:"#dc2626"}];return e.jsxs(J,{breadcrumbs:[{title:"Field Control",href:"/admin/field-controls"}],children:[e.jsx(X,{title:"Field Control Management"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6 bg-slate-50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-slate-900",children:"Field Control"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Monitor and manage agent inspections."})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:V.map((s,c)=>e.jsx("div",{style:{backgroundColor:s.bgColor},className:"rounded-xl p-4 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white/80",children:s.label}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:s.value})]}),e.jsx(s.icon,{className:"h-10 w-10 text-white/30"})]})},c))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 bg-white p-4 rounded-xl border border-slate-200 shadow-sm",children:[e.jsx("div",{className:"font-medium text-slate-900",children:"All Inspections"}),e.jsxs("div",{className:"relative w-72",children:[e.jsx(re,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-500"}),e.jsx(ee,{placeholder:"Search Control #, Agent...",className:"pl-9 bg-slate-50 border-slate-200 focus:border-blue-500",value:t.search,onChange:s=>b(c=>({...c,search:s.target.value,page:1}))})]})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:[e.jsxs(Q,{children:[e.jsx(W,{className:"bg-slate-50",children:e.jsxs(g,{children:[e.jsx(n,{className:"font-semibold text-slate-600",children:"Control #"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Agent"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Business"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Date"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Compliance"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Status"}),e.jsx(n,{className:"text-right font-semibold text-slate-600",children:"Actions"})]})}),e.jsx(Y,{children:u?e.jsx(g,{children:e.jsx(r,{colSpan:7,className:"h-24 text-center",children:e.jsx(f,{className:"h-6 w-6 animate-spin mx-auto text-blue-500"})})}):w.length===0?e.jsx(g,{children:e.jsx(r,{colSpan:7,className:"h-24 text-center text-slate-500",children:"No field controls found."})}):w.map(s=>e.jsxs(g,{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx(r,{className:"font-mono font-medium text-slate-700",children:s.control_number}),e.jsx(r,{className:"text-slate-600",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-50 rounded-lg text-blue-600",children:e.jsx(K,{className:"h-3.5 w-3.5"})}),s.agent_name]})}),e.jsxs(r,{children:[e.jsx("div",{className:"font-medium text-slate-700",children:s.taxpayer_name||s.business_name}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),s.location||s.location_address]})]}),e.jsx(r,{className:"text-slate-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-3.5 w-3.5 text-slate-400"}),_(s.control_date)]})}),e.jsx(r,{children:e.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${parseFloat(s.compliance_rate)>=80?"bg-emerald-100 text-emerald-700":parseFloat(s.compliance_rate)>=50?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:s.compliance_rate})}),e.jsx(r,{children:e.jsx(Z,{variant:"outline",className:`${H(s.status)} font-medium`,children:s.status.replace("_"," ").toUpperCase()})}),e.jsx(r,{className:"text-right",children:e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>$(s),className:"h-8 w-8 text-slate-500 hover:text-blue-600",children:e.jsx(ne,{className:"h-4 w-4"})})})]},s.id))})]}),o>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-slate-100",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:["Showing ",Math.min((t.page-1)*t.pageSize+1,o)," to ",Math.min(t.page*t.pageSize,o)," of ",o," entries"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>b(s=>({...s,page:s.page-1})),disabled:t.page===1||u,children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>b(s=>({...s,page:s.page+1})),disabled:t.page>=U||u,children:e.jsx(oe,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(F,{open:M,onOpenChange:d,children:e.jsxs(T,{className:"sm:max-w-4xl bg-white text-slate-900 border-slate-200",children:[e.jsxs(D,{children:[e.jsxs(k,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(le,{className:"h-6 w-6 text-blue-600"}),"Control #",a?.control_number]}),e.jsx(I,{className:"text-slate-500",children:"Field Inspection Details & Compliance Report"})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 gap-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-900 border-b pb-2",children:"Inspection Info"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Agent"}),e.jsx("span",{className:"font-medium",children:a.agent_name})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Business"}),e.jsx("span",{className:"font-medium",children:a.taxpayer_name||a.business_name})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Location"}),e.jsx("span",{className:"font-medium",children:a.location||a.location_address})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Date"}),e.jsx("span",{className:"font-medium",children:_(a.control_date)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Type"}),e.jsx("span",{className:"font-medium",children:a.control_type})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-900 border-b pb-2",children:"Compliance Stats"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Total Checked"}),e.jsx("p",{className:"font-bold text-lg",children:a.total_items_checked})]}),e.jsxs("div",{className:"bg-emerald-50 p-3 rounded-lg",children:[e.jsx("span",{className:"text-emerald-600 text-xs",children:"Compliant"}),e.jsx("p",{className:"font-bold text-lg text-emerald-700",children:a.compliant_items})]}),e.jsxs("div",{className:"bg-amber-50 p-3 rounded-lg",children:[e.jsx("span",{className:"text-amber-600 text-xs",children:"Non-Compliant"}),e.jsx("p",{className:"font-bold text-lg text-amber-700",children:a.non_compliant_items})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[e.jsx("span",{className:"text-red-600 text-xs",children:"Counterfeit"}),e.jsx("p",{className:"font-bold text-lg text-red-700",children:a.counterfeit_items})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Compliance Rate"}),e.jsx("div",{className:`text-2xl font-bold ${parseFloat(a.compliance_rate)>=80?"text-emerald-600":parseFloat(a.compliance_rate)>=50?"text-amber-600":"text-red-600"}`,children:a.compliance_rate})]})]}),a.observations&&e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx("h3",{className:"font-semibold text-slate-900 border-b pb-2",children:"Observations"}),e.jsx("p",{className:"text-sm text-slate-600",children:a.observations})]}),a.offence_declared&&e.jsxs("div",{className:"col-span-2 bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-red-800 flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"})," Offence Declared"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:a.offence_description}),a.proposed_fine>0&&e.jsxs("p",{className:"text-sm font-medium text-red-800 mt-2",children:["Proposed Fine: $",a.proposed_fine.toLocaleString()]})]})]}),e.jsxs(R,{className:"gap-2 sm:gap-0 border-t pt-4",children:[e.jsx(i,{variant:"outline",onClick:()=>d(!1),children:"Close"}),a?.status==="completed"&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"destructive",onClick:()=>p(!0),children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," Flag Issue"]}),e.jsxs(i,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:q,disabled:!!h,children:[h===a?.id?e.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(A,{className:"mr-2 h-4 w-4"}),"Approve"]})]})]})]})}),e.jsx(F,{open:P,onOpenChange:p,children:e.jsxs(T,{className:"sm:max-w-md bg-white text-slate-900",children:[e.jsxs(D,{children:[e.jsx(k,{children:"Flag Inspection Issue"}),e.jsx(I,{children:"Please provide details about the issue with this field control report."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{children:"Issue Description"}),e.jsx(ae,{placeholder:"e.g. Incomplete documentation, missing photos...",value:N,onChange:s=>S(s.target.value)})]})}),e.jsxs(R,{children:[e.jsx(i,{variant:"ghost",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(i,{variant:"destructive",onClick:E,disabled:!N||!!h,children:[h?e.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Confirm Flag"]})]})]})})]})]})}export{ze as default};
