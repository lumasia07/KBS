import{r,j as e,H as _,a as v,t as u}from"./app-XxGQqHEn.js";import{A as B,P as R}from"./app-layout-CPmwDeKB.js";import{T as O,a as A,b as x,c,d as G,e as l}from"./table-CkgMGDrt.js";import{B as o}from"./button-Bl64q_Yk.js";import{B as L}from"./badge-BHeNVAji.js";import{I as H}from"./input-BJMzkf2c.js";import{D as I,a as F,b as Q,c as U,d as V,e as $}from"./dialog-C34YEPG_.js";import{S as K}from"./search-CT3nxiHW.js";import{L as w}from"./loader-circle-D76T6EdY.js";import{c as W}from"./createLucideIcon-B9VDQ0kY.js";import{C as J}from"./chevron-left-BnVSDa1W.js";import{C as X}from"./chevron-right-BxG1ta4i.js";import{C as Y}from"./circle-check-big-B8rD91MQ.js";/* empty css            */import"./Combination-DsTawVx1.js";import"./x-CTpenCwg.js";import"./index-CjOQgEXZ.js";import"./index-EBLA1b0H.js";import"./users-BhW82ob4.js";const Z=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],y=W("qr-code",Z);function ge(){const[f,S]=r.useState([]),[m,j]=r.useState(!0),[d,k]=r.useState(0),[t,h]=r.useState({page:1,pageSize:10,search:""}),[a,C]=r.useState(null),[P,p]=r.useState(!1),[b,g]=r.useState(!1),[n,N]=r.useState(null),T=async()=>{j(!0);try{const s={draw:Date.now(),start:(t.page-1)*t.pageSize,length:t.pageSize,search:{value:t.search,regex:!1}},i=await v.get("/admin/production",{params:s,headers:{Accept:"application/json"}});S(i.data.data),k(i.data.recordsTotal)}catch(s){console.error("Failed to fetch orders",s),u.error("Failed to load production queue")}finally{j(!1)}};r.useEffect(()=>{const s=setTimeout(()=>{T()},300);return()=>clearTimeout(s)},[t.page,t.search]);const M=s=>{C(s),N(null),p(!0)},D=async()=>{if(a){g(!0);try{const s=await v.post(`/admin/production/${a.id}/generate`),i=Math.floor(Math.random()*9e15)+1e15,z={serial_start:s.data.preview_data?.serial_start||i.toString(),serial_end:s.data.preview_data?.serial_end||(i+a.quantity).toString(),quantity:a.quantity};N(z),u.success("Production batch created successfully")}catch(s){u.error(s.response?.data?.message||"Generation failed")}finally{g(!1)}}},E=s=>{switch(s){case"approved":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"in_production":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-slate-100 text-slate-800 border-slate-200"}},q=Math.ceil(d/t.pageSize);return e.jsxs(B,{breadcrumbs:[{title:"Production & Generation",href:"/admin/production"}],children:[e.jsx(_,{title:"Sticker Generation"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6 bg-slate-50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-slate-900",children:"Sticker Production"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Manage orders ready for stamp generation and printing."})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 bg-white p-4 rounded-xl border border-slate-200 shadow-sm",children:[e.jsx("div",{className:"font-medium text-slate-900",children:"Processing Queue (Ready for Print)"}),e.jsxs("div",{className:"relative w-72",children:[e.jsx(K,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-500"}),e.jsx(H,{placeholder:"Search order #...",className:"pl-9 bg-slate-50 border-slate-200 focus:border-blue-500",value:t.search,onChange:s=>h(i=>({...i,search:s.target.value,page:1}))})]})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:[e.jsxs(O,{children:[e.jsx(A,{className:"bg-slate-50",children:e.jsxs(x,{children:[e.jsx(c,{className:"font-semibold text-slate-600",children:"Order #"}),e.jsx(c,{className:"font-semibold text-slate-600",children:"Taxpayer"}),e.jsx(c,{className:"font-semibold text-slate-600",children:"Product"}),e.jsx(c,{className:"font-semibold text-slate-600",children:"Qty"}),e.jsx(c,{className:"font-semibold text-slate-600",children:"Status"}),e.jsx(c,{className:"text-right font-semibold text-slate-600",children:"Options"})]})}),e.jsx(G,{children:m?e.jsx(x,{children:e.jsx(l,{colSpan:6,className:"h-24 text-center",children:e.jsx(w,{className:"h-6 w-6 animate-spin mx-auto text-blue-500"})})}):f.length===0?e.jsx(x,{children:e.jsx(l,{colSpan:6,className:"h-24 text-center text-slate-500",children:"No orders ready for production."})}):f.map(s=>e.jsxs(x,{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx(l,{className:"font-medium text-slate-700",children:s.order_number}),e.jsx(l,{className:"text-slate-600",children:s.taxpayer_name}),e.jsx(l,{className:"text-slate-600",children:s.product_name}),e.jsx(l,{className:"text-slate-600",children:s.quantity.toLocaleString()}),e.jsx(l,{children:e.jsx(L,{variant:"outline",className:`${E(s.status)} font-medium`,children:s.status.toUpperCase()})}),e.jsx(l,{className:"text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsxs(o,{size:"sm",className:"bg-[#003366] hover:bg-[#002244] text-white flex items-center gap-2",onClick:()=>M(s),children:[e.jsx(y,{className:"h-4 w-4"}),"Preview & Generate"]})})})]},s.id))})]}),d>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-slate-100",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:["Showing ",Math.min((t.page-1)*t.pageSize+1,d)," to ",Math.min(t.page*t.pageSize,d)," of ",d," entries"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>h(s=>({...s,page:s.page-1})),disabled:t.page===1||m,children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>h(s=>({...s,page:s.page+1})),disabled:t.page>=q||m,children:e.jsx(X,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(I,{open:P,onOpenChange:p,children:e.jsxs(F,{className:"sm:max-w-2xl bg-white text-slate-900 border-slate-200",children:[e.jsxs(Q,{children:[e.jsx(U,{className:"text-slate-900",children:"Digital Digital Stamp Preview"}),e.jsxs(V,{className:"text-slate-500",children:["Anticipated output for Order #",a?.order_number,". Verify security features before generation."]})]}),a&&e.jsxs("div",{className:"flex flex-col items-center py-6 gap-6",children:[e.jsxs("div",{className:"relative w-[400px] h-[200px] bg-gradient-to-br from-slate-50 via-blue-50 to-slate-100 border-4 border-double border-[#003366] rounded-lg shadow-lg flex overflow-hidden",children:[e.jsx("div",{className:"absolute -top-[50%] -left-[50%] w-[200%] h-[200%] bg-gradient-to-r from-transparent via-white/30 to-transparent rotate-45 animate-pulse pointer-events-none"}),e.jsxs("div",{className:"w-1/3 border-r-2 border-dotted border-[#003366]/30 p-2 flex flex-col items-center justify-center bg-white/50 backdrop-blur-sm",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-900 rounded-sm flex items-center justify-center text-white text-xs",children:e.jsx(y,{className:"w-16 h-16 opacity-80"})}),e.jsx("div",{className:"mt-2 text-[10px] font-mono font-bold text-[#003366]",children:n?n.serial_start:"KBS-PREVIEW"})]}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-between relative",children:[e.jsxs("div",{className:"text-center border-b border-[#003366]/20 pb-2",children:[e.jsx("h3",{className:"text-[10px] font-bold text-slate-500 tracking-widest uppercase",children:"Republique Democratique du Congo"}),e.jsx("h2",{className:"text-sm font-black text-[#003366] uppercase mt-1",children:"Bureau of Standards"})]}),e.jsxs("div",{className:"space-y-1 my-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-slate-500",children:"Product:"}),e.jsx("span",{className:"font-bold text-slate-900 truncate max-w-[120px]",children:a.product_name})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-slate-500",children:"Taxpayer:"}),e.jsx("span",{className:"font-bold text-slate-900 truncate max-w-[120px]",children:a.taxpayer_name})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-slate-500",children:"Value:"}),e.jsx("span",{className:"font-bold text-[#003366]",children:"Excisable"})]})]}),e.jsx("div",{className:"text-[8px] text-center text-slate-400 mt-auto",children:"AUTHENTICATED • SECURE • TRACEABLE"})]})]}),e.jsxs("div",{className:"w-full bg-slate-50 p-4 rounded-lg border border-slate-200 text-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Quantity to Generate:"}),e.jsxs("span",{className:"font-medium",children:[a.quantity.toLocaleString()," units"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Estimated Batch Size:"}),e.jsxs("span",{className:"font-medium",children:["~",Math.ceil(a.quantity/1e3)," Rolls"]})]}),n&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-600 font-medium mb-2",children:[e.jsx(Y,{className:"w-4 h-4"})," Generation Complete"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white p-2 border rounded",children:[e.jsx("span",{className:"text-slate-500 block",children:"Start Serial"}),e.jsx("span",{className:"font-mono font-bold",children:n.serial_start})]}),e.jsxs("div",{className:"bg-white p-2 border rounded",children:[e.jsx("span",{className:"text-slate-500 block",children:"End Serial"}),e.jsx("span",{className:"font-mono font-bold",children:n.serial_end})]})]})]})]})]}),e.jsxs($,{className:"gap-2 sm:gap-0",children:[e.jsx(o,{variant:"outline",onClick:()=>p(!1),className:"border-slate-300",children:"Close"}),n?e.jsx(o,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"Download Batch PDF"}):e.jsxs(o,{className:"bg-[#003366] hover:bg-[#002244]",onClick:D,disabled:b,children:[b?e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(R,{className:"mr-2 h-4 w-4"}),"Start Production"]})]})]})})]})]})}export{ge as default};
