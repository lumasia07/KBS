import{r as d,j as e,c as J,H as Q,L as Y,t as k,a as ee,b as te}from"./app-BI1qWzfo.js";import{b as se,A as ne,C as re}from"./app-layout-CBYSz2Gl.js";import{c as oe,u as M,a as ae,B as F}from"./button-DS2xtBod.js";import{I as N}from"./input-CCrkRVhC.js";import{L as b}from"./label-Cr1kewY3.js";import{T as E}from"./textarea-BYK_THIl.js";import{u as ie,c as T,S as L,a as O,b as A,d as y}from"./select-B-E86dGa.js";import{u as ce,c as B,a as le}from"./Combination-BrEcmAtv.js";import{C as de}from"./check-DEXSFZPh.js";import{A as me}from"./arrow-left-BPpL28pe.js";import{T as $}from"./x-BnhRkkuD.js";import{L as pe}from"./loader-circle-Dfh0JFqS.js";import{S as ue}from"./save-C4mZiozI.js";/* empty css            */import"./createLucideIcon-BloLWxr-.js";import"./index-BXqZ-mcf.js";import"./index-EBLA1b0H.js";import"./credit-card-DSbVGSO8.js";import"./chevron-down-nO2F-D5b.js";function xe(o,s=[]){let i=[];function t(c,l){const m=d.createContext(l),n=i.length;i=[...i,l];const a=p=>{const{scope:x,children:g,...h}=p,j=x?.[o]?.[n]||m,_=d.useMemo(()=>h,Object.values(h));return e.jsx(j.Provider,{value:_,children:g})};a.displayName=c+"Provider";function u(p,x){const g=x?.[o]?.[n]||m,h=d.useContext(g);if(h)return h;if(l!==void 0)return l;throw new Error(`\`${p}\` must be used within \`${c}\``)}return[a,u]}const r=()=>{const c=i.map(l=>d.createContext(l));return function(m){const n=m?.[o]||c;return d.useMemo(()=>({[`__scope${o}`]:{...m,[o]:n}}),[m,n])}};return r.scopeName=o,[t,he(r,...s)]}function he(...o){const s=o[0];if(o.length===1)return s;const i=()=>{const t=o.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(c){const l=t.reduce((m,{useScope:n,scopeName:a})=>{const p=n(c)[`__scope${a}`];return{...m,...p}},{});return d.useMemo(()=>({[`__scope${s.scopeName}`]:l}),[l])}};return i.scopeName=s.scopeName,i}function fe(o){const s=be(o),i=d.forwardRef((t,r)=>{const{children:c,...l}=t,m=d.Children.toArray(c),n=m.find(ge);if(n){const a=n.props.children,u=m.map(p=>p===n?d.Children.count(a)>1?d.Children.only(null):d.isValidElement(a)?a.props.children:null:p);return e.jsx(s,{...l,ref:r,children:d.isValidElement(a)?d.cloneElement(a,void 0,u):null})}return e.jsx(s,{...l,ref:r,children:c})});return i.displayName=`${o}.Slot`,i}function be(o){const s=d.forwardRef((i,t)=>{const{children:r,...c}=i;if(d.isValidElement(r)){const l=Ce(r),m=je(c,r.props);return r.type!==d.Fragment&&(m.ref=t?oe(t,l):l),d.cloneElement(r,m)}return d.Children.count(r)>1?d.Children.only(null):null});return s.displayName=`${o}.SlotClone`,s}var ve=Symbol("radix.slottable");function ge(o){return d.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===ve}function je(o,s){const i={...s};for(const t in s){const r=o[t],c=s[t];/^on[A-Z]/.test(t)?r&&c?i[t]=(...m)=>{const n=c(...m);return r(...m),n}:r&&(i[t]=r):t==="style"?i[t]={...r,...c}:t==="className"&&(i[t]=[r,c].filter(Boolean).join(" "))}return{...o,...i}}function Ce(o){let s=Object.getOwnPropertyDescriptor(o.props,"ref")?.get,i=s&&"isReactWarning"in s&&s.isReactWarning;return i?o.ref:(s=Object.getOwnPropertyDescriptor(o,"ref")?.get,i=s&&"isReactWarning"in s&&s.isReactWarning,i?o.props.ref:o.props.ref||o.ref)}var _e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],R=_e.reduce((o,s)=>{const i=fe(`Primitive.${s}`),t=d.forwardRef((r,c)=>{const{asChild:l,...m}=r,n=l?i:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(n,{...m,ref:c})});return t.displayName=`Primitive.${s}`,{...o,[s]:t}},{}),S="Checkbox",[Ne]=xe(S),[ye,P]=Ne(S);function ke(o){const{__scopeCheckbox:s,checked:i,children:t,defaultChecked:r,disabled:c,form:l,name:m,onCheckedChange:n,required:a,value:u="on",internal_do_not_use_render:p}=o,[x,g]=ce({prop:i,defaultProp:r??!1,onChange:n,caller:S}),[h,j]=d.useState(null),[_,f]=d.useState(null),v=d.useRef(!1),w=h?!!l||!!h.closest("form"):!0,I={checked:x,disabled:c,setChecked:g,control:h,setControl:j,name:m,form:l,value:u,hasConsumerStoppedPropagationRef:v,required:a,defaultChecked:C(r)?!1:r,isFormControl:w,bubbleInput:_,setBubbleInput:f};return e.jsx(ye,{scope:s,...I,children:Se(p)?p(I):t})}var V="CheckboxTrigger",H=d.forwardRef(({__scopeCheckbox:o,onKeyDown:s,onClick:i,...t},r)=>{const{control:c,value:l,disabled:m,checked:n,required:a,setControl:u,setChecked:p,hasConsumerStoppedPropagationRef:x,isFormControl:g,bubbleInput:h}=P(V,o),j=M(r,u),_=d.useRef(n);return d.useEffect(()=>{const f=c?.form;if(f){const v=()=>p(_.current);return f.addEventListener("reset",v),()=>f.removeEventListener("reset",v)}},[c,p]),e.jsx(R.button,{type:"button",role:"checkbox","aria-checked":C(n)?"mixed":n,"aria-required":a,"data-state":U(n),"data-disabled":m?"":void 0,disabled:m,value:l,...t,ref:j,onKeyDown:B(s,f=>{f.key==="Enter"&&f.preventDefault()}),onClick:B(i,f=>{p(v=>C(v)?!0:!v),h&&g&&(x.current=f.isPropagationStopped(),x.current||f.stopPropagation())})})});H.displayName=V;var q=d.forwardRef((o,s)=>{const{__scopeCheckbox:i,name:t,checked:r,defaultChecked:c,required:l,disabled:m,value:n,onCheckedChange:a,form:u,...p}=o;return e.jsx(ke,{__scopeCheckbox:i,checked:r,defaultChecked:c,disabled:m,required:l,onCheckedChange:a,name:t,form:u,value:n,internal_do_not_use_render:({isFormControl:x})=>e.jsxs(e.Fragment,{children:[e.jsx(H,{...p,ref:s,__scopeCheckbox:i}),x&&e.jsx(K,{__scopeCheckbox:i})]})})});q.displayName=S;var z="CheckboxIndicator",W=d.forwardRef((o,s)=>{const{__scopeCheckbox:i,forceMount:t,...r}=o,c=P(z,i);return e.jsx(se,{present:t||C(c.checked)||c.checked===!0,children:e.jsx(R.span,{"data-state":U(c.checked),"data-disabled":c.disabled?"":void 0,...r,ref:s,style:{pointerEvents:"none",...o.style}})})});W.displayName=z;var G="CheckboxBubbleInput",K=d.forwardRef(({__scopeCheckbox:o,...s},i)=>{const{control:t,hasConsumerStoppedPropagationRef:r,checked:c,defaultChecked:l,required:m,disabled:n,name:a,value:u,form:p,bubbleInput:x,setBubbleInput:g}=P(G,o),h=M(i,g),j=ie(c),_=le(t);d.useEffect(()=>{const v=x;if(!v)return;const w=window.HTMLInputElement.prototype,D=Object.getOwnPropertyDescriptor(w,"checked").set,X=!r.current;if(j!==c&&D){const Z=new Event("click",{bubbles:X});v.indeterminate=C(c),D.call(v,C(c)?!1:c),v.dispatchEvent(Z)}},[x,j,c,r]);const f=d.useRef(C(c)?!1:c);return e.jsx(R.input,{type:"checkbox","aria-hidden":!0,defaultChecked:l??f.current,required:m,disabled:n,name:a,value:u,form:p,...s,tabIndex:-1,ref:h,style:{...s.style,..._,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});K.displayName=G;function Se(o){return typeof o=="function"}function C(o){return o==="indeterminate"}function U(o){return C(o)?"indeterminate":o?"checked":"unchecked"}function we(o){const s=J.c(9);let i,t;s[0]!==o?({className:i,...t}=o,s[0]=o,s[1]=i,s[2]=t):(i=s[1],t=s[2]);let r;s[3]!==i?(r=ae("peer border-input data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",i),s[3]=i,s[4]=r):r=s[4];let c;s[5]===Symbol.for("react.memo_cache_sentinel")?(c=e.jsx(W,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(de,{className:"size-3.5"})}),s[5]=c):c=s[5];let l;return s[6]!==t||s[7]!==r?(l=e.jsx(q,{"data-slot":"checkbox",className:r,...t,children:c}),s[6]=t,s[7]=r,s[8]=l):l=s[8],l}function Ke({taxpayers:o=[]}){const[s,i]=d.useState(!1),[t,r]=d.useState({taxpayer_id:"",business_name:"",location_address:"",control_type:"routine",total_items_checked:0,compliant_items:0,non_compliant_items:0,counterfeit_items:0,observations:"",recommendations:"",offence_declared:!1,offence_description:"",proposed_fine:0}),c=n=>{const a=o.find(u=>u.id===n);a&&r(u=>({...u,taxpayer_id:n,business_name:a.company_name,location_address:a.physical_address}))},l=async n=>{if(n.preventDefault(),!t.business_name||!t.location_address){k.error("Please fill in business name and location");return}if(t.total_items_checked<1){k.error("Please check at least one item");return}i(!0);try{await ee.post("/agent/inspections",t),k.success("Inspection recorded successfully!"),te.visit("/agent/inspections")}catch(a){k.error(a.response?.data?.message||"Failed to save inspection")}finally{i(!1)}},m=t.total_items_checked>0?(t.compliant_items/t.total_items_checked*100).toFixed(1):"0";return e.jsxs(ne,{breadcrumbs:[{title:"Inspections",href:"/agent/inspections"},{title:"New Inspection",href:"/agent/inspections/create"}],children:[e.jsx(Q,{title:"New Inspection"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Y,{href:"/agent/inspections",children:e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(me,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-slate-900",children:"New Inspection"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Record a new field inspection."})]})]}),e.jsxs("form",{onSubmit:l,className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600"}),"Business Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(b,{children:"Select Registered Taxpayer (Optional)"}),e.jsxs(T,{onValueChange:c,children:[e.jsx(L,{className:"mt-1",children:e.jsx(O,{placeholder:"Search or select a taxpayer..."})}),e.jsx(A,{children:o.map(n=>e.jsxs(y,{value:n.id,children:[n.company_name," (",n.tax_identification_number,")"]},n.id))})]})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Business Name *"}),e.jsx(N,{className:"mt-1",value:t.business_name,onChange:n=>r(a=>({...a,business_name:n.target.value})),placeholder:"Enter business name",required:!0})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Location/Address *"}),e.jsx(N,{className:"mt-1",value:t.location_address,onChange:n=>r(a=>({...a,location_address:n.target.value})),placeholder:"Enter location",required:!0})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Inspection Type"}),e.jsxs(T,{value:t.control_type,onValueChange:n=>r(a=>({...a,control_type:n})),children:[e.jsx(L,{className:"mt-1",children:e.jsx(O,{})}),e.jsxs(A,{children:[e.jsx(y,{value:"routine",children:"Routine Inspection"}),e.jsx(y,{value:"random",children:"Random Check"}),e.jsx(y,{value:"follow_up",children:"Follow-up"}),e.jsx(y,{value:"complaint",children:"Complaint-based"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Compliance Data"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Total Items Checked *"}),e.jsx(N,{type:"number",min:"0",className:"mt-1",value:t.total_items_checked,onChange:n=>r(a=>({...a,total_items_checked:parseInt(n.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Compliant Items"}),e.jsx(N,{type:"number",min:"0",className:"mt-1",value:t.compliant_items,onChange:n=>r(a=>({...a,compliant_items:parseInt(n.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Non-Compliant Items"}),e.jsx(N,{type:"number",min:"0",className:"mt-1",value:t.non_compliant_items,onChange:n=>r(a=>({...a,non_compliant_items:parseInt(n.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Counterfeit Items"}),e.jsx(N,{type:"number",min:"0",className:"mt-1",value:t.counterfeit_items,onChange:n=>r(a=>({...a,counterfeit_items:parseInt(n.target.value)||0}))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(b,{children:"Observations"}),e.jsx(E,{className:"mt-1",placeholder:"Enter your observations...",value:t.observations,onChange:n=>r(a=>({...a,observations:n.target.value}))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(b,{children:"Recommendations"}),e.jsx(E,{className:"mt-1",placeholder:"Enter recommendations...",value:t.recommendations,onChange:n=>r(a=>({...a,recommendations:n.target.value}))})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(we,{id:"offence",checked:t.offence_declared,onCheckedChange:n=>r(a=>({...a,offence_declared:n}))}),e.jsxs(b,{htmlFor:"offence",className:"text-lg font-semibold text-red-700 flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Declare Offence"]})]}),t.offence_declared&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Offence Description *"}),e.jsx(E,{className:"mt-1",placeholder:"Describe the offence...",value:t.offence_description,onChange:n=>r(a=>({...a,offence_description:n.target.value}))})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx(b,{children:"Proposed Fine (CDF)"}),e.jsx(N,{type:"number",min:"0",className:"mt-1",value:t.proposed_fine,onChange:n=>r(a=>({...a,proposed_fine:parseFloat(n.target.value)||0}))})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6 sticky top-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Compliance Rate"}),e.jsxs("p",{className:`text-4xl font-bold ${parseFloat(m)>=80?"text-emerald-600":parseFloat(m)>=50?"text-amber-600":"text-red-600"}`,children:[m,"%"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"bg-emerald-50 p-2 rounded text-center",children:[e.jsx("p",{className:"text-emerald-600 font-bold",children:t.compliant_items}),e.jsx("p",{className:"text-xs text-emerald-700",children:"Compliant"})]}),e.jsxs("div",{className:"bg-red-50 p-2 rounded text-center",children:[e.jsx("p",{className:"text-red-600 font-bold",children:t.non_compliant_items}),e.jsx("p",{className:"text-xs text-red-700",children:"Non-Compliant"})]})]}),t.counterfeit_items>0&&e.jsx("div",{className:"bg-red-100 border border-red-200 p-3 rounded-lg text-center",children:e.jsxs("p",{className:"text-red-800 font-bold",children:[t.counterfeit_items," Counterfeit Items"]})}),t.offence_declared&&e.jsxs("div",{className:"bg-red-100 border border-red-200 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-red-800 font-bold flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"})," Offence Declared"]}),t.proposed_fine>0&&e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Fine: ",t.proposed_fine.toLocaleString()," CDF"]})]})]}),e.jsxs(F,{type:"submit",className:"w-full mt-6 bg-blue-600 hover:bg-blue-700",disabled:s,children:[s?e.jsx(pe,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Save Inspection"]})]})})]})]})]})}export{Ke as default};
