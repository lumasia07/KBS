import{r,j as e,H as Y,a as y,t as o}from"./app-uM-PAfCE.js";import{A as J}from"./app-layout-Dy1iYxBT.js";import{T as K,a as W,b as u,c as n,d as Z,e as c}from"./table-x7K6f6LE.js";import{B as i}from"./button-ViEb6EJD.js";import{B as L}from"./badge-DvSv9WzO.js";import{I as ee}from"./input-QaqkRY8g.js";import{D as C,a as S,b as O,c as k,d as R,e as D}from"./dialog-CKy0p5nm.js";import{L as l}from"./label-DQ7SZYjg.js";import{S as se}from"./search-E_zcIRvl.js";import{L as T}from"./loader-circle-CDyxlgjH.js";import{C as I}from"./circle-check-big-BC7CvNXF.js";import{C as _}from"./circle-x-DNkEgbQ4.js";import{E as ae}from"./eye-DRLrBxIQ.js";import{C as te}from"./chevron-left-BisN8626.js";import{C as re}from"./chevron-right-7AzItvZM.js";import{T as le}from"./x-oZdVZXX7.js";/* empty css            */import"./Combination-Bijxp1xg.js";import"./createLucideIcon-DbKPOAFU.js";import"./index-p1i7ejeS.js";import"./index-EBLA1b0H.js";import"./users-kadJDkF9.js";function Re(){const[A,M]=r.useState([]),[g,z]=r.useState(!0),[m,q]=r.useState(0),[t,b]=r.useState({page:1,pageSize:10,search:""}),[d,x]=r.useState(null),[a,f]=r.useState(null),[B,v]=r.useState(!1),[E,h]=r.useState(!1),[H,p]=r.useState(!1),[N,P]=r.useState(""),w=async()=>{z(!0);try{const s={draw:Date.now(),start:(t.page-1)*t.pageSize,length:t.pageSize,search:{value:t.search,regex:!1}},j=await y.get("/admin/orders",{params:s,headers:{Accept:"application/json"}});M(j.data.data),q(j.data.recordsTotal)}catch(s){console.error("Failed to fetch orders",s),o.error("Failed to load orders")}finally{z(!1)}};r.useEffect(()=>{const s=setTimeout(()=>{w()},300);return()=>clearTimeout(s)},[t.page,t.search]);const $=s=>{f(s),h(!0)},Q=async()=>{if(console.log("confirmApprove called",a),!!a){x(a.id);try{console.log("Sending request to",`/admin/orders/${a.id}/approve`),await y.post(`/admin/orders/${a.id}/approve`),console.log("Request successful"),o.success("Order approved successfully"),w(),h(!1)}catch(s){console.error("Request failed",s),o.error(s.response?.data?.message||"Failed to approve order")}finally{x(null)}}},U=s=>{f(s),P(""),p(!0)},G=async()=>{if(a){if(!N.trim()){o.error("Please provide a rejection reason");return}x(a.id);try{await y.post(`/admin/orders/${a.id}/reject`,{reason:N}),o.success("Order rejected successfully"),w(),p(!1)}catch(s){o.error(s.response?.data?.message||"Failed to reject order")}finally{x(null)}}},V=s=>{f(s),v(!0)},F=s=>{switch(s){case"delivered":case"completed":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"approved":case"in_production":case"ready_for_delivery":return"bg-blue-100 text-blue-800 border-blue-200";case"submitted":case"pending":return"bg-amber-100 text-amber-800 border-amber-200";case"cancelled":case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-slate-100 text-slate-800 border-slate-200"}},X=Math.ceil(m/t.pageSize);return e.jsxs(J,{breadcrumbs:[{title:"Order Management",href:"/admin/orders"}],children:[e.jsx(Y,{title:"Manage Orders"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6 bg-slate-50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-slate-900",children:"Order Management"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 bg-white p-4 rounded-xl border border-slate-200 shadow-sm",children:[e.jsx("div",{className:"font-medium text-slate-900",children:"All Stamp Orders"}),e.jsxs("div",{className:"relative w-72",children:[e.jsx(se,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-500"}),e.jsx(ee,{placeholder:"Search taxpayer, order #...",className:"pl-9 bg-slate-50 border-slate-200 focus:border-blue-500",value:t.search,onChange:s=>b(j=>({...j,search:s.target.value,page:1}))})]})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:[e.jsxs(K,{children:[e.jsx(W,{className:"bg-slate-50",children:e.jsxs(u,{children:[e.jsx(n,{className:"font-semibold text-slate-600",children:"Order #"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Taxpayer"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Product"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Qty"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Status"}),e.jsx(n,{className:"font-semibold text-slate-600",children:"Date"}),e.jsx(n,{className:"text-right font-semibold text-slate-600",children:"Actions"})]})}),e.jsx(Z,{children:g?e.jsx(u,{children:e.jsx(c,{colSpan:7,className:"h-24 text-center",children:e.jsx(T,{className:"h-6 w-6 animate-spin mx-auto text-blue-500"})})}):A.length===0?e.jsx(u,{children:e.jsx(c,{colSpan:7,className:"h-24 text-center text-slate-500",children:"No orders found."})}):A.map(s=>e.jsxs(u,{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx(c,{className:"font-medium text-slate-700",children:s.order_number}),e.jsx(c,{className:"text-slate-600",children:s.taxpayer_name}),e.jsx(c,{className:"text-slate-600",children:s.product_name}),e.jsx(c,{className:"text-slate-600",children:s.quantity.toLocaleString()}),e.jsx(c,{children:e.jsx(L,{variant:"outline",className:`${F(s.status)} font-medium`,children:s.status.toUpperCase()})}),e.jsx(c,{className:"text-slate-500 text-sm",children:s.created_at}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[(s.status==="submitted"||s.status==="pending")&&e.jsxs(e.Fragment,{children:[e.jsx(i,{size:"icon",variant:"ghost",className:"h-8 w-8 text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50 rounded-full",onClick:()=>$(s),disabled:d===s.id,children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx(i,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-full",onClick:()=>U(s),disabled:d===s.id,children:e.jsx(_,{className:"h-4 w-4"})})]}),e.jsx(i,{size:"icon",variant:"ghost",className:"h-8 w-8 text-slate-500 hover:text-blue-600 hover:bg-blue-50 rounded-full",onClick:()=>V(s),children:e.jsx(ae,{className:"h-4 w-4"})})]})})]},s.id))})]}),m>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-slate-100",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:["Showing ",Math.min((t.page-1)*t.pageSize+1,m)," to ",Math.min(t.page*t.pageSize,m)," of ",m," entries"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>b(s=>({...s,page:s.page-1})),disabled:t.page===1||g,children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>b(s=>({...s,page:s.page+1})),disabled:t.page>=X||g,children:e.jsx(re,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(C,{open:B,onOpenChange:v,children:e.jsxs(S,{className:"sm:max-w-xl bg-white text-slate-900 border-slate-200",children:[e.jsxs(O,{children:[e.jsx(k,{className:"text-slate-900",children:"Order Details"}),e.jsxs(R,{className:"text-slate-500",children:["Review complete information for Order #",a?.order_number]})]}),a&&e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-slate-500",children:"Taxpayer"}),e.jsx("div",{className:"font-medium text-slate-900",children:a.taxpayer_name})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-slate-500",children:"Status"}),e.jsx("div",{children:e.jsx(L,{variant:"outline",className:F(a.status),children:a.status.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-slate-500",children:"Product"}),e.jsx("div",{className:"font-medium text-slate-900",children:a.product_name})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-slate-500",children:"Packaging"}),e.jsx("div",{className:"capitalize text-slate-900",children:a.packaging_type})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-slate-500",children:"Quantity"}),e.jsx("div",{className:"text-slate-900",children:a.quantity.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-slate-500",children:"Grand Total"}),e.jsx("div",{className:"font-bold text-lg text-slate-900",children:new Intl.NumberFormat("fr-CD",{style:"currency",currency:"CDF"}).format(a.grand_total)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{className:"text-slate-500",children:"Delivery Address"}),e.jsx("div",{className:"text-slate-900",children:a.delivery_method==="pickup"?"Store Pickup":a.delivery_address})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-slate-500",children:"Payment Method"}),e.jsx("div",{className:"capitalize text-slate-900",children:a.payment_method?.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-slate-500",children:"Date Placed"}),e.jsx("div",{className:"text-slate-900",children:a.created_at})]}),a.rejection_reason&&e.jsxs("div",{className:"col-span-2 bg-red-50 p-3 rounded-md border border-red-100",children:[e.jsx(l,{className:"text-red-600 font-semibold mb-1 block",children:"Rejection Reason"}),e.jsx("div",{className:"text-red-700 text-sm",children:a.rejection_reason})]})]})}),e.jsx(D,{children:e.jsx(i,{variant:"outline",onClick:()=>v(!1),className:"text-slate-700 border-slate-300 hover:bg-slate-50",children:"Close"})})]})}),e.jsx(C,{open:E,onOpenChange:h,children:e.jsxs(S,{className:"bg-white text-slate-900 border-slate-200",children:[e.jsxs(O,{children:[e.jsx(k,{className:"text-slate-900",children:"Approve Order"}),e.jsxs(R,{className:"text-slate-500",children:["Are you sure you want to approve Order ",e.jsx("b",{children:a?.order_number}),"? This will move the order to Processing status."]})]}),e.jsxs(D,{children:[e.jsx(i,{variant:"outline",onClick:()=>h(!1),className:"text-slate-700 border-slate-300 hover:bg-slate-50",children:"Cancel"}),e.jsxs(i,{className:"bg-emerald-600 hover:bg-emerald-700 text-white border-0",onClick:Q,disabled:!!d,children:[d?e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(I,{className:"mr-2 h-4 w-4"}),"Confirm Approval"]})]})]})}),e.jsx(C,{open:H,onOpenChange:p,children:e.jsxs(S,{className:"bg-white text-slate-900 border-slate-200",children:[e.jsxs(O,{children:[e.jsxs(k,{className:"text-red-600 flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Reject Order"]}),e.jsxs(R,{className:"text-slate-500",children:["You are about to reject Order ",e.jsx("b",{children:a?.order_number}),". Please provide a reason for the taxpayer."]})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(l,{htmlFor:"reason",className:"mb-2 block text-slate-700",children:"Rejection Reason"}),e.jsx("textarea",{id:"reason",className:"flex min-h-[100px] w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 text-slate-900",placeholder:"e.g., Invalid Import Declaration document...",value:N,onChange:s=>P(s.target.value)})]}),e.jsxs(D,{children:[e.jsx(i,{variant:"outline",onClick:()=>p(!1),className:"text-slate-700 border-slate-300 hover:bg-slate-50",children:"Cancel"}),e.jsxs(i,{variant:"destructive",className:"bg-red-600 hover:bg-red-700 text-white border-0",onClick:G,disabled:!!d,children:[d?e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(_,{className:"mr-2 h-4 w-4"}),"Reject Order"]})]})]})})]})]})}export{Re as default};
