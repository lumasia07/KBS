import{r as l,j as e,H as $,a as N,t as o}from"./app-uM-PAfCE.js";import{A as V}from"./app-layout-Dy1iYxBT.js";import{T as q,a as U,b as h,c as d,d as X,e as i}from"./table-x7K6f6LE.js";import{B as r}from"./button-ViEb6EJD.js";import{B as G}from"./badge-DvSv9WzO.js";import{I as J}from"./input-QaqkRY8g.js";import{D as C,a as w,b as T,c as S,d as R,e as _}from"./dialog-CKy0p5nm.js";import{L as K}from"./label-DQ7SZYjg.js";import{T as Q}from"./textarea-C2NkU47E.js";import{S as W}from"./search-E_zcIRvl.js";import{L as D}from"./loader-circle-CDyxlgjH.js";import{B as I}from"./building-2-Gkjb26mP.js";import{E as Y}from"./eye-DRLrBxIQ.js";import{C as Z}from"./chevron-left-BisN8626.js";import{C as ee}from"./chevron-right-7AzItvZM.js";import{C as se}from"./circle-x-DNkEgbQ4.js";import{C as ae}from"./circle-check-big-BC7CvNXF.js";/* empty css            */import"./Combination-Bijxp1xg.js";import"./x-oZdVZXX7.js";import"./createLucideIcon-DbKPOAFU.js";import"./index-p1i7ejeS.js";import"./index-EBLA1b0H.js";import"./users-kadJDkF9.js";function Re(){const[b,k]=l.useState([]),[j,v]=l.useState(!0),[n,z]=l.useState(0),[t,g]=l.useState({page:1,pageSize:10,search:""}),[a,B]=l.useState(null),[A,c]=l.useState(!1),[L,m]=l.useState(!1),[f,M]=l.useState(""),[y,x]=l.useState(null),u=async()=>{v(!0);try{const s={draw:Date.now(),start:(t.page-1)*t.pageSize,length:t.pageSize,search:{value:t.search,regex:!1}},p=await N.get("/admin/taxpayers",{params:s,headers:{Accept:"application/json"}});k(p.data.data),z(p.data.recordsTotal)}catch(s){console.error("Failed to fetch taxpayers",s),o.error("Failed to load taxpayers")}finally{v(!1)}};l.useEffect(()=>{const s=setTimeout(()=>{u()},300);return()=>clearTimeout(s)},[t.page,t.search]);const E=s=>{B(s),c(!0)},F=async()=>{if(a){x(a.id);try{await N.post(`/admin/taxpayers/${a.id}/approve`),o.success("Taxpayer approved successfully"),u(),c(!1)}catch(s){o.error(s.response?.data?.message||"Failed to approve taxpayer")}finally{x(null)}}},O=async()=>{if(a){x(a.id);try{await N.post(`/admin/taxpayers/${a.id}/reject`,{rejection_reason:f}),o.success("Taxpayer rejected successfully"),u(),m(!1),c(!1)}catch(s){o.error(s.response?.data?.message||"Failed to reject taxpayer")}finally{x(null)}}},H=s=>{switch(s){case"active":case"approved":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"pending":return"bg-amber-100 text-amber-800 border-amber-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-slate-100 text-slate-800 border-slate-200"}},P=Math.ceil(n/t.pageSize);return e.jsxs(V,{breadcrumbs:[{title:"Taxpayers",href:"/admin/taxpayers"}],children:[e.jsx($,{title:"Taxpayer Management"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6 bg-slate-50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-slate-900",children:"Taxpayers"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Manage registered companies and approval status."})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 bg-white p-4 rounded-xl border border-slate-200 shadow-sm",children:[e.jsx("div",{className:"font-medium text-slate-900",children:"Registered Companies"}),e.jsxs("div",{className:"relative w-72",children:[e.jsx(W,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-500"}),e.jsx(J,{placeholder:"Search Name, TIN...",className:"pl-9 bg-slate-50 border-slate-200 focus:border-blue-500",value:t.search,onChange:s=>g(p=>({...p,search:s.target.value,page:1}))})]})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:[e.jsxs(q,{children:[e.jsx(U,{className:"bg-slate-50",children:e.jsxs(h,{children:[e.jsx(d,{className:"font-semibold text-slate-600",children:"Company"}),e.jsx(d,{className:"font-semibold text-slate-600",children:"TIN"}),e.jsx(d,{className:"font-semibold text-slate-600",children:"Sector"}),e.jsx(d,{className:"font-semibold text-slate-600",children:"Status"}),e.jsx(d,{className:"text-right font-semibold text-slate-600",children:"Actions"})]})}),e.jsx(X,{children:j?e.jsx(h,{children:e.jsx(i,{colSpan:5,className:"h-24 text-center",children:e.jsx(D,{className:"h-6 w-6 animate-spin mx-auto text-blue-500"})})}):b.length===0?e.jsx(h,{children:e.jsx(i,{colSpan:5,className:"h-24 text-center text-slate-500",children:"No taxpayers found."})}):b.map(s=>e.jsxs(h,{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx(i,{className:"font-medium text-slate-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg text-blue-600",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.company_name}),e.jsx("div",{className:"text-xs text-slate-500",children:s.email})]})]})}),e.jsx(i,{className:"text-slate-600 font-mono",children:s.tax_identification_number}),e.jsx(i,{className:"text-slate-600",children:s.sector_name}),e.jsx(i,{children:e.jsx(G,{variant:"outline",className:`${H(s.registration_status)} font-medium`,children:s.registration_status.toUpperCase()})}),e.jsx(i,{className:"text-right",children:e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>E(s),className:"h-8 w-8 text-slate-500 hover:text-blue-600",children:e.jsx(Y,{className:"h-4 w-4"})})})]},s.id))})]}),n>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-slate-100",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:["Showing ",Math.min((t.page-1)*t.pageSize+1,n)," to ",Math.min(t.page*t.pageSize,n)," of ",n," entries"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>g(s=>({...s,page:s.page-1})),disabled:t.page===1||j,children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>g(s=>({...s,page:s.page+1})),disabled:t.page>=P||j,children:e.jsx(ee,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(C,{open:A,onOpenChange:c,children:e.jsxs(w,{className:"sm:max-w-3xl bg-white text-slate-900 border-slate-200",children:[e.jsxs(T,{children:[e.jsxs(S,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(I,{className:"h-6 w-6 text-blue-600"}),a?.company_name]}),e.jsx(R,{className:"text-slate-500",children:"Registration Details & Validation Status"})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 gap-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-900 border-b pb-2",children:"Company Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Tax ID (TIN)"}),e.jsx("span",{className:"font-mono font-medium",children:a.tax_identification_number})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"RCCM Number"}),e.jsx("span",{className:"font-medium",children:a.trade_register_number})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Business Sector"}),e.jsx("span",{className:"font-medium",children:a.sector_name})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-900 border-b pb-2",children:"Contact & Rep"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Address"}),e.jsx("span",{className:"font-medium",children:a.physical_address})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Email / Phone"}),e.jsxs("span",{className:"font-medium",children:[a.email," â€¢ ",a.phone_number]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:"Legal Representative"}),e.jsxs("span",{className:"font-medium",children:[a.legal_representative_name," (",a.legal_representative_phone,")"]})]})]})]})]}),e.jsxs(_,{className:"gap-2 sm:gap-0 border-t pt-4",children:[e.jsx(r,{variant:"outline",onClick:()=>c(!1),children:"Close"}),a?.registration_status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"destructive",onClick:()=>m(!0),children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Reject"]}),e.jsxs(r,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:F,disabled:!!y,children:[y===a?.id?e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Approve Registration"]})]})]})]})}),e.jsx(C,{open:L,onOpenChange:m,children:e.jsxs(w,{className:"sm:max-w-md bg-white text-slate-900",children:[e.jsxs(T,{children:[e.jsx(S,{children:"Reject Registration"}),e.jsx(R,{children:"Please provide a reason for rejecting this taxpayer application."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{children:"Rejection Reason"}),e.jsx(Q,{placeholder:"e.g. Invalid RCCM document...",value:f,onChange:s=>M(s.target.value)})]})}),e.jsxs(_,{children:[e.jsx(r,{variant:"ghost",onClick:()=>m(!1),children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:O,disabled:!f,children:"Confirm Reject"})]})]})})]})]})}export{Re as default};
